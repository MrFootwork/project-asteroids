var W=a=>{throw TypeError(a)};var we=(a,e,t)=>e.has(a)||W("Cannot "+t);var w=(a,e,t)=>e.has(a)?W("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,t);var o=(a,e,t)=>(we(a,e,"access private method"),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&s(h)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();var c,I,G,P,j,T,N,z;class xe{constructor({spaceshipElement:e,gameScreen:t,keys:s,state:i}){w(this,c);this.gameScreen=t,this.element=e,this.keys=s,this.isAccelerating=!1,this.isDecelerating=!1,this.state=i,this.ANGLE_OFFSET=Math.PI/2,this.SPEED=8,this.ROTATIONAL_SPEED=.2,this.position={x:0,y:0},this.velocity={x:0,y:0},this.rotaionalVelocity=0,this.orientation=0,this.thrustOrientation=0,this.dimension={width:e.clientWidth,height:e.clientHeight},this.hasHitTheEdge=!1}update(){o(this,c,N).call(this),o(this,c,G).call(this),o(this,c,P).call(this),o(this,c,j).call(this),o(this,c,z).call(this),o(this,c,T).call(this),o(this,c,I).call(this)}deflectFromObstacle(){this.hasHitTheEdge&&(this.velocity.x=-this.velocity.x,this.velocity.y=-this.velocity.y,this.state.sfxOn&&hitWallSoundPlayer.play(),this.hasHitTheEdge=!1),o(this,c,P).call(this);const e=.9;this.velocity.x*=e,this.velocity.y*=e,o(this,c,T).call(this),o(this,c,I).call(this)}getCurrentVelocity(){return{x:Math.cos(this.orientation-this.ANGLE_OFFSET),y:Math.sin(this.orientation-this.ANGLE_OFFSET)}}getCollisionShape(){return{x:this.position.x+this.element.clientWidth/2,y:this.position.y+this.element.clientHeight/2,radius:this.element.clientWidth/2}}setPosition(e){if(!e){this.position.x=(gameScreen.clientWidth-this.element.clientWidth||70)/2,this.position.y=(gameScreen.clientHeight-this.element.clientHeight||70)/2;return}this.position.x=e.x,this.position.y=e.y}setVelocity(e){if(!e){this.velocity.x=0,this.velocity.y=0;return}this.velocity.x=e.x,this.velocity.y=e.y}}c=new WeakSet,I=function(){this.element.style.left=`${this.position.x}px`,this.element.style.top=`${this.position.y}px`,this.element.style.transform=`rotate(${this.orientation}rad)`},G=function(){this.isAccelerating=this.keys.arrowUp.pressed,this.isDecelerating=this.keys.arrowDown.pressed},P=function(){let e=0;this.keys.arrowLeft.pressed&&(e=-1),this.keys.arrowRight.pressed&&(e=1);const t=.03;this.rotaionalVelocity+=e*t;const s=.8;this.rotaionalVelocity*=s;const i=this.ROTATIONAL_SPEED;this.rotaionalVelocity>i&&(this.rotaionalVelocity=i),this.rotaionalVelocity<-i&&(this.rotaionalVelocity=-i),this.orientation+=this.rotaionalVelocity},j=function(){let e=0;this.isAccelerating&&(e=.2);const t=e*Math.cos(this.orientation-this.ANGLE_OFFSET),s=e*Math.sin(this.orientation-this.ANGLE_OFFSET);this.velocity.x+=t,this.velocity.y+=s;const i=.99;this.velocity.x*=i,this.velocity.y*=i,this.isDecelerating&&(this.velocity.x*=.94,this.velocity.y*=.94);const n=Math.sqrt(this.velocity.x**2+this.velocity.y**2),h=this.SPEED;n>h&&(this.velocity.x=this.velocity.x/n*h,this.velocity.y=this.velocity.y/n*h)},T=function(){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y},N=function(){this.dimension.width||(this.dimension.width=this.element.clientWidth,this.dimension.height=this.element.clientHeight)},z=function(){const e=this.position.x<0||this.position.x+this.dimension.width>this.gameScreen.clientWidth||this.position.y<0||this.position.y+this.dimension.height>this.gameScreen.clientHeight;this.hasHitTheEdge=e};var g,U,K,X;class Ee{constructor({gameScreen:e,spaceshipElement:t,position:s,velocity:i,projectileElement:n,orientation:h}){w(this,g);this.gameScreen=e,this.spaceshipElement=t,this.element=n,this.width=20,this.position=s,this.velocity=i,this.orientation=h,this.hasBeenRenderedOnce=!1,this.isOutside=!1,this.hasHitTarget=!1}update(){o(this,g,K).call(this),o(this,g,X).call(this),o(this,g,U).call(this)}getCollisionShape(){return{x:this.position.x+this.width/2+20,y:this.position.y+this.width/2+20,radius:this.width/2}}}g=new WeakSet,U=function(){this.element.style.left=`${this.position.x}px`,this.element.style.top=`${this.position.y}px`,this.hasBeenRenderedOnce||(this.element.style.width=`${this.width}px`,this.element.style.transform=`
        translateX(${(this.spaceshipElement.clientWidth-this.width)/2}px)
        translateY(${(this.spaceshipElement.clientHeight-this.width)/2}px)
        rotate(${this.orientation}rad)
        translateY(-${(this.spaceshipElement.clientHeight-this.width+30)/2}px)
      `,this.hasBeenRenderedOnce=!0)},K=function(){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y},X=function(){const e=this.gameScreen.getBoundingClientRect(),t=this.element.getBoundingClientRect(),s=t.right<e.left||t.left>e.right||t.bottom<e.top||t.top>e.bottom;this.isOutside=s};var u,Y,J,Q,Z,ee;class Oe{constructor({position:e,velocity:t,width:s,element:i,gameScreen:n}){w(this,u);this.gameScreen=n,this.element=i,this.position=e,this.velocity=t,this.width=s,this.ROTATIONAL_SPEED=-.04+Math.random()*.08,this.orientation=0,this.isOutside=!1,this.hasCollided=!1,this.isShot=!1,this.hasEnteredScreen=!1,this.hasBeenRenderedOnce=!1}update(){o(this,u,J).call(this),o(this,u,Q).call(this),this.hasEnteredScreen&&o(this,u,ee).call(this),this.hasEnteredScreen||o(this,u,Z).call(this),o(this,u,Y).call(this)}getCollisionShape(){return{x:this.position.x+this.width/2,y:this.position.y+this.width/2,radius:this.width/2}}}u=new WeakSet,Y=function(){this.element.style.left=`${this.position.x}px`,this.element.style.top=`${this.position.y}px`,this.element.style.transform=`rotate(${this.orientation}rad)`,this.hasBeenRenderedOnce||(this.element.style.width=`${this.width}px`,this.hasBeenRenderedOnce=!0)},J=function(){this.orientation+=this.ROTATIONAL_SPEED},Q=function(){this.position.x+=this.velocity.x,this.position.y+=this.velocity.y},Z=function(){const e=this.position.x+this.width>=20&&this.position.x<=this.gameScreen.clientWidth-20&&this.position.y+this.width>=20&&this.position.y<=this.gameScreen.clientHeight-20;this.hasEnteredScreen=e},ee=function(){const e=this.position.x+this.width<20||this.position.x>this.gameScreen.clientWidth-20||this.position.y+this.width<20||this.position.y>this.gameScreen.clientHeight-20;this.isOutside=e};const E={1:{initialAsteroids:3,spawnRate:5e3,speedMultiplier:1,startPosition:null,asteroidSpeed:1.5},2:{initialAsteroids:5,spawnRate:4e3,speedMultiplier:1.2,startPosition:null,asteroidSpeed:2},3:{initialAsteroids:7,spawnRate:3e3,speedMultiplier:1.5,startPosition:null,asteroidSpeed:2.5},4:{initialAsteroids:9,spawnRate:2500,speedMultiplier:1.5,startPosition:null,asteroidSpeed:2.5},5:{initialAsteroids:11,spawnRate:2e3,speedMultiplier:1.2,startPosition:null,asteroidSpeed:2.5}},Le="mrfootwork.github.io",Ae="project-asteroids";function L(){return window.location.hostname===Le?`/${Ae}/`:""}const O=60,be=Math.round(1e3/O),$=1/0;var r,D,te,ie,se,R,oe,ne,F,re,ae,M,H,q,he;class ke{constructor({gameScreen:e,state:t}){w(this,r);this.keys={arrowUp:{pressed:!1},arrowDown:{pressed:!1},arrowLeft:{pressed:!1},arrowRight:{pressed:!1},space:{pressed:!1}},this.gameScreen=e,this.state=t,this.currentFrame=0,this.gameloopIntervalID=null,this.currentLevelID=1,this.currentLevel=E[this.currentLevelID],this.remainingTime=$,this.spaceship=new xe({spaceshipElement:o(this,r,he).call(this),gameScreen:e,keys:this.keys,state:t}),this.player={lives:3,score:0,hasWon:!1},this.frameAtObstacleHit=null,this.HIT_OBSTACLE_DURATION=40,this.projectiles=[],this.fireRate=O/2,this.lastFired=null,this.asteroids=[],this.baseAsteroidSpeed=1.5}start(){requestAnimationFrame(()=>{timeDisplay.textContent=this.getFormattedRemainingTime(),o(this,r,H).call(this),o(this,r,q).call(this),o(this,r,M).call(this)}),this.screenSize={width:this.gameScreen.clientWidth,height:this.gameScreen.clientHeight},this.currentLevel=E[this.currentLevelID],o(this,r,ne).call(this,this.currentLevel.initialAsteroids),requestAnimationFrame(()=>o(this,r,D).call(this))}reset(){clearInterval(this.gameloopIntervalID),this.gameloopIntervalID=null,this.currentFrame=0,this.remainingTime=$,this.player.hasWon||(this.currentLevelID=1),this.player.hasWon&&E[this.currentLevelID+1]&&++this.currentLevelID,this.currentLevel=E[this.currentLevelID],this.player.hasWon=!1,[this.asteroids,this.projectiles].forEach((e,t)=>{const s=[".asteroid",".projectile"];for(let n=e.length-1;n>=0;n--)e[n].element.remove(),e.splice(n,1);const i=document.querySelectorAll(s[t]);for(const n of i)n.remove()}),this.player.lives=3,this.player.score=0,this.spaceship.setPosition(this.currentLevel.startPosition),this.spaceship.setVelocity(),this.spaceship.orientation=0,this.spaceship.update(),this.fireRate=Math.round(1e3/12),this.lastFired=null,this.baseAsteroidSpeed=this.currentLevel.asteroidSpeed}resizeScreen(){this.screenSize={width:this.gameScreen.clientWidth,height:this.gameScreen.clientHeight}}getFormattedRemainingTime(){const e=Math.floor(this.remainingTime/60),t=(this.remainingTime%60).toString().padStart(2,"0");return`${e}:${t}`}onKeyDown(e){switch(e.code){case"ArrowUp":case"KeyW":this.keys.arrowUp.pressed=!0;break;case"ArrowDown":case"KeyS":this.keys.arrowDown.pressed=!0;break;case"ArrowLeft":case"KeyA":this.keys.arrowLeft.pressed=!0;break;case"ArrowRight":case"KeyD":this.keys.arrowRight.pressed=!0;break;case"Space":this.keys.space.pressed=!0;break}}onKeyUp(e){switch(e.code){case"ArrowUp":case"KeyW":this.keys.arrowUp.pressed=!1;break;case"ArrowDown":case"KeyS":this.keys.arrowDown.pressed=!1;break;case"ArrowLeft":case"KeyA":this.keys.arrowLeft.pressed=!1;break;case"ArrowRight":case"KeyD":this.keys.arrowRight.pressed=!1;break;case"Space":this.keys.space.pressed=!1;break;case"KeyP":case"Pause":this.pauseOrResumeGame();break}}pauseOrResumeGame(){if(this.gameloopIntervalID){o(this,r,R).call(this);return}if(!this.gameloopIntervalID){o(this,r,D).call(this);return}}}r=new WeakSet,D=function(){this.gameloopIntervalID=setInterval(()=>{if(this.currentFrame++,o(this,r,M).call(this),o(this,r,se).call(this)){o(this,r,R).call(this),this.player.lives===0&&(this.gameScreen.parentElement.style.backgroundColor="black",this.gameScreen.classList.add("shake"));return}o(this,r,ie).call(this)},be)},te=function(){_({spaceshipVelocity:this.spaceship.velocity,backgroundElement:backgroundImageSolid,decelerationFactor:.03}),_({spaceshipVelocity:this.spaceship.velocity,backgroundElement:backgroundImageTransparent,decelerationFactor:.02})},ie=function(){this.spaceship.hasHitTheEdge||this.frameAtObstacleHit?o(this,r,oe).call(this):this.spaceship.update(),o(this,r,te).call(this),o(this,r,ae).call(this),o(this,r,re).call(this);e:for(let e=this.projectiles.length-1;e>=0;e--){const t=this.projectiles[e];t:for(let s=this.asteroids.length-1;s>=0;s--){const i=this.asteroids[s];if(V(t.getCollisionShape(),i.getCollisionShape())){const h=new Audio("assets/sounds/rock-break.mp3");this.state.sfxOn&&h.play(),this.player.score++,o(this,r,H).call(this),t.hasHitTarget=!0,i.isShot=!0,i.element.remove(),this.asteroids.splice(s,1);break t}}if(t.isOutside||t.hasHitTarget){t.element.remove(),this.projectiles.splice(e,1);continue e}t.update()}for(let e=this.asteroids.length-1;e>=0;e--){const t=this.asteroids[e],s=V(this.spaceship.getCollisionShape(),t.getCollisionShape());if(s&&(t.hasCollided=!0,this.player.lives--,o(this,r,q).call(this)),s&&!this.player.lives)break;if(t.hasEnteredScreen&&t.isOutside||t.hasCollided||t.isShot||s){t.element.remove(),this.asteroids.splice(e,1);continue}t.update()}},se=function(){const e=this.remainingTime===0,t=this.player.lives===0;return e&&!t&&(this.player.hasWon=!0),(e||t)&&console.log("Game has ended. TimeIsUp, playerIsDead: ",e,t),e||t},R=function(){clearInterval(this.gameloopIntervalID),this.gameloopIntervalID=null},oe=function(){this.frameAtObstacleHit||(this.frameAtObstacleHit=this.currentFrame),this.spaceship.deflectFromObstacle(),this.currentFrame-this.frameAtObstacleHit>=this.HIT_OBSTACLE_DURATION&&(this.frameAtObstacleHit=null)},ne=function(e){for(let t=0;t<e;t++)o(this,r,F).call(this)},F=function(){let e={x:null,y:null};const t=50+Math.floor(Math.random()*150),s=["top","right","bottom","left"][Math.floor(Math.random()*4)];let i=null;const n=.3,h=n*Math.random()-n/2;let l=null;const d=1/1.1;switch(s){case"top":e.x=Math.floor(Math.random()*this.screenSize.width),e.y=0-t,l=(e.x/this.screenSize.width-.5)*d,i=(.5+h+l)*Math.PI;break;case"right":e.x=this.screenSize.width+100,e.y=Math.floor(Math.random()*this.screenSize.height),l=(e.y/this.screenSize.height-.5)*d,i=(1+h+l)*Math.PI;break;case"bottom":e.x=Math.floor(Math.random()*this.screenSize.width),e.y=this.screenSize.height,l=(e.x/this.screenSize.width-.5)*d,i=(1.5+h-l)*Math.PI;break;case"left":e.x=0-t,e.y=Math.floor(Math.random()*this.screenSize.height),l=(e.y/this.screenSize.height-.5)*d,i=(2+h-l)*Math.PI;break}const y=.2+Math.random()*this.baseAsteroidSpeed*this.currentLevel.speedMultiplier,v={x:y*Math.cos(i),y:y*Math.sin(i)},f=document.createElement("div");f.className="asteroid";const x=document.createElement("img");x.src=`${L()}assets/images/asteroid.png`,f.appendChild(x),this.gameScreen.appendChild(f);const S=new Oe({position:e,velocity:v,width:t,element:f,gameScreen:this.gameScreen});this.asteroids.push(S)},re=function(){this.currentFrame*O%this.currentLevel.spawnRate===0&&o(this,r,F).call(this)},ae=function(){const e=Date.now();if(this.keys.space.pressed&&e-this.lastFired>=this.fireRate){this.lastFired=e;const t=new Audio("assets/sounds/laser-gun-shot.mp3");this.state.sfxOn&&t.play();const s=document.createElement("div");s.className="projectile",this.gameScreen.appendChild(s);const i=new Ee({gameScreen:this.gameScreen,position:{x:this.spaceship.position.x,y:this.spaceship.position.y},velocity:{x:8*this.spaceship.getCurrentVelocity().x,y:8*this.spaceship.getCurrentVelocity().y},projectileElement:s,orientation:this.spaceship.orientation,spaceshipElement:this.spaceship.element});this.projectiles.push(i)}},M=function(){this.currentFrame%O===0&&(this.remainingTime--,timeDisplay.textContent=this.getFormattedRemainingTime())},H=function(){scoreDisplay.textContent=this.player.score},q=function(){livesDisplay.textContent=this.player.lives},he=function(){const e=document.createElement("div");e.id="spaceship";const t=document.createElement("img");return t.src=`${L()}assets/images/spaceship.png`,e.appendChild(t),this.gameScreen.appendChild(e),e};function V(a,e){const t=e.x-a.x,s=e.y-a.y;return Math.sqrt(t**2+s**2)<a.radius+e.radius}function _({spaceshipVelocity:a,backgroundElement:e,decelerationFactor:t}){const s=window.getComputedStyle(e),i=s.backgroundPosition.includes(", "),n=i?1:0,[h,l]=i?s.backgroundPosition.split(", ")[n].split(" "):s.backgroundPosition.split(" "),d=parseFloat(h)+a.x*t,y=parseFloat(l)+a.y*t;e.style.backgroundPosition=`${i?"50% 50%, ":""}${d}% ${y}%`}let m;document.addEventListener("DOMContentLoaded",()=>{var a={musicOn:!0,sfxOn:!0};const e=document.querySelector("#musicControlPanel"),t=document.querySelector(".icon-button.music"),s=document.querySelector(".icon-button.sfx"),i=document.querySelector("#introOverlay"),n=document.querySelector("#introScreen"),h=document.querySelector("#skipIntroInstruction"),l=document.querySelector("#videoPlayer");l.muted=!0;const d=document.getElementById("musicPlayer"),y=document.querySelector("#musicPlayer source"),v=document.querySelector("#homeScreen"),f=document.querySelector("#startButton"),x=document.querySelector("#newGameButton");document.querySelector("#settingsButton"),document.querySelector("#exitButton");const S=document.querySelector("#gameScreen");document.querySelector("#backgroundImageSolid"),document.querySelector("#backgroundImageTransparent");const ce=document.querySelector("#gameOverButton"),le=document.querySelector("#pauseButton");document.querySelector("#timeDisplay"),document.querySelector("#scoreDisplay"),document.querySelector("#livesDisplay");const A=document.querySelector("#resultScreen"),de=document.querySelector("#toHomeButton"),pe=document.querySelector("#restartButton"),C=document.querySelector("#buttonHoverSoundPlayer");document.querySelector("#hitWallSoundPlayer");const ue=document.querySelectorAll("button:not(:disabled)"),me=document.querySelectorAll("audio.sfx");m=new ke({gameScreen:S,state:a}),n.addEventListener("click",ye),n.addEventListener("keyup",ge),ve(),f.addEventListener("click",b),x.addEventListener("click",()=>{m.currentLevelID=1,b()}),de.addEventListener("click",k),pe.addEventListener("click",b),ue.forEach(p=>{p.addEventListener("mouseenter",()=>{a.sfxOn&&(C.currentTime=0,C.play())})}),t.addEventListener("click",p=>{a.musicOn=!a.musicOn,d.paused?d.play():d.pause(),p.target.blur()}),s.addEventListener("click",p=>{a.sfxOn=!a.sfxOn,me.forEach(B=>{B.pause(),B.currentTime=0}),p.target.blur()}),l.addEventListener("ended",()=>{console.log("The video has finished playing!"),k()});function ye(){d.volume=.6,d.play().catch(p=>console.error("Playback error:",p)),l.src=`${L()}assets/videos/asteroids-migration.mp4`,l.playbackRate=.7,l.play(),i.classList.add("fade-out-overlay"),setTimeout(()=>{h.classList.add("show-skip-intro-instruction")},500),setTimeout(()=>{console.log("next Video"),l.src=`${L()}assets/videos/asteroid-approaching-earth.mp4`},8820)}function ge(p){p.code==="Space"&&k()}function b(){Se(),y.src.split("/").at(-1)!=="stardust-ambient.mp3"&&(y.src="assets/sounds/stardust-ambient.mp3",d.load()),d.volume=.3,a.musicOn&&d.play(),v.style.display="none",S.style.display="block",A.style.display="none"}function fe(){m.pauseOrResumeGame(),v.style.display="none",S.style.display="none",A.style.display="block"}function k(){d.volume=.3,y.src="assets/sounds/metropolis-of-the-future.mp3",d.load(),a.musicOn&&d.play(),v.style.display="flex",S.style.display="none",A.style.display="none",n.style.display="none",e.classList.add("show")}function Se(){requestAnimationFrame(()=>{m&&m.reset()}),requestAnimationFrame(()=>{m.start();const p=29;setTimeout(()=>{console.warn(`Pausing for testing at frame ${p}.`)},p)})}function ve(){window.addEventListener("resize",m.resizeScreen),ce.addEventListener("click",fe),le.addEventListener("click",()=>m.pauseOrResumeGame()),document.addEventListener("keydown",p=>m.onKeyDown(p)),document.addEventListener("keyup",p=>m.onKeyUp(p))}});
